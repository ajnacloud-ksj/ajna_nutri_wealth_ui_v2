name: Deploy UI to CloudFront

on:
  push:
    branches: [main]
  workflow_dispatch:  # Allow manual deployment

jobs:
  deploy:
    uses: ajnacloud-ksj/ajna-github-workflows/.github/workflows/reusable-static-site.yml@main
    with:
      # AWS Configuration
      aws-region: 'us-east-1'
      
      # S3 bucket for hosting static files
      s3-bucket: 'nutriwealth-ui'
      
      # Optional: S3 path prefix (leave empty for root)
      s3-path: ''
      
      # CloudFront Distribution ID (for cache invalidation)
      cloudfront-distribution-id: ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }}
      
      # GitHub OIDC Role ARN (replace with your role)
      # Format: arn:aws:iam::ACCOUNT_ID:role/GitHubActionsRole
      role-to-assume: ${{ secrets.AWS_ROLE_ARN }}
      
      # Working directory (where package.json is located)
      working-directory: '.'
      
      # Node.js version for building
      node-version: '20'
      
      # Backend API URL (injected as VITE_API_URL during build)
      api-url: ${{ secrets.VITE_API_URL }}
    secrets: inherit
